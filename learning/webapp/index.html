<!DOCTYPE html>
<html lang="en">
<head>
    <title>ToDoアプリ</title>
    <style>
        .todo-list {
            list-style-type: none;
        }

        .todo-item {
            border: 1px solid #333;
            margin: 5px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>ToDoアプリ</h1>
    <input id="todoInput" type="text" placeholder="タスクを入力" />
    <button onclick="addTodo()">タスクを追加</button>
    <ul id="todoList" class="todo-list"></ul>

    <script>
        // ページが読み込まれたとき、localStorageからタスクを取得し、それをDOMに追加
        window.onload = function() {
            var tasks = JSON.parse(localStorage.getItem('tasks'));

            if (tasks) {
                tasks.forEach(function(task) {
                    addTodoDOM(task);
                });
            }
        }

        // タスクをDOMに追加する関数
        function addTodoToDOM(task) {
            var todoList = document.getElementById('todoList');

            var newTodo = document.createElement('li');
            newTodo.textContent = task;
            newTodo.className = 'todo-item';

            // タスクをクリックすると、DOMからタスクを削除し、さらにlocalStrageからも削除する
            newTodo.addEventListener('click', function() {
                todoList.removeChild(newTodo);
                removeFromLocalStorage(task);
            });

            todoList.appendChild(newTodo);
        }

        // タスクを追加する関数
        function addTodo() {
            /*
            // 入力フィールドとリストの要素を取得
            var todoInput = document.getElementById('todoInput');
            
            var todoList = document.getElementById('todoList');

            // 新しいリストアイテム要素を作成
            var newTodo = document.createElement('li');
            // 新しいアイテムのテキストを入力フィールドの値に設定
            newTodo.textContent = todoInput.value;
            // スタイルを適用するためのクラスを設定
            newTodo.className = 'todo-item';

            // クリックイベントリスナーを新しいアイテムに追加
            // アイテムがクリックされたときに、アイテムをリストから削除
            newTodo.addEventListener('click', function() {
                todoList.removeChild(newTodo);
            });

            // 新しいアイテムをリストに追加
            todoList.appendChild(newTodo);
            // 入力フィールドをクリア
            todoInput.value = '';
            */
            var todoInput = document.getElementById('todoInput');

            // 入力フィールドから取得したタスクをDOMとlocalStorageに追加
            var task = todoInput.value;
            if (task) {
                addTodoToDOM(task);
                addToLocalStorage(task);

                todoInput.value = '';
            }

        }

        // タスクをローカルストレージに追加する関数
        function addToLocalStorage(task) {
            // 先に既存のタスクを取得、タスクがまだない場合は空の配列を使用・
            var tasks = JSON.parse(localStorage.getItem('tasks')) || [];

            // 新たなタスクを配列に追加
            tasks.push(task);

            // タスクの配列をJSON形式に変換し、それを'tasks'キーでlocalStorageに保存
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        // タスクをローカルストレージから削除する関数
        function removeFromLocalStorage(task) {
            var tasks = JSON.parse(localStorage.getItem('tasks')) || [];

            // 削除するタスクのインデクスを取得
            var taskIndex = tasks.indexOf(task);
            // タスクが存在すれば配列から削除
            if (taskIndex != -1) {
                tasks.splice(taskIndex, 1);
                // タスクが削除された配列をJSON形式に変換し、それを'tasks'キーでlocalStorageに保存
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }
        }

    </script>
</body>
</html>
